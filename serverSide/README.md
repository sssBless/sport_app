# Sport App - Серверная часть

## Описание
Серверная часть Sport App представляет собой REST API, разработанный на Node.js с использованием TypeScript и Fastify. Сервер обеспечивает всю бизнес-логику приложения, работу с базой данных и аутентификацию пользователей, а также поддерживает real-time обновления через Socket.io.

## Технический стек
- Node.js
- TypeScript
- Fastify (веб-фреймворк)
- PostgreSQL (база данных)
- Knex.js (SQL query builder)
- Socket.io (веб-сокеты)
- Bcrypt (хеширование паролей)

## База данных
Приложение использует PostgreSQL с следующей структурой:

### Основные таблицы
- `users` - информация о пользователях
- `workouts` - тренировки
- `workout_participants` - участники тренировок
- `exercises` - упражнения
- `workout_exercises` - упражнения в тренировках
- `invitations` - приглашения на тренировки

## Установка и запуск

### Предварительные требования
- Node.js (рекомендуется версия 16 или выше)
- PostgreSQL (версия 12 или выше)
- npm или yarn

### Конфигурация
Настройки сервера находятся в файле `config.ts`:
```ts
// config.ts
{
  server: {
    port: number
  },
  db: {
    host: string,
    port: number,
    database: string,
    user: string,
    password: string
  },
  auth: {
    cookieName: string,
    cookieSecret: string,
    tokenExpiresIn: string
  }
}
```

### Запуск сервера
```bash
# Запуск только серверной части в режиме разработки
npm run dev:server

# Запуск всего проекта (клиент + сервер)
npm run dev

# Сборка серверной части
npm run build:server
```

## API Endpoints

### Аутентификация
- `POST /auth/register` - регистрация нового пользователя
- `POST /auth/login` - вход в систему
- `POST /auth/logout` - выход из системы
- `GET /auth/me` - информация о текущем пользователе

### Тренировки
- `GET /workouts` - получение списка тренировок
- `POST /workouts` - создание новой тренировки
- `GET /workouts/:id` - получение информации о тренировке
- `PUT /workouts/:id` - обновление тренировки
- `DELETE /workouts/:id` - удаление тренировки

### Упражнения
- `GET /exercises` - список всех упражнений
- `POST /exercises` - добавление нового упражнения
- `PUT /exercises/:id` - обновление упражнения

### Приглашения
- `POST /invitations` - создание приглашения
- `PUT /invitations/:id` - обновление статуса приглашения

## Real-time функциональность

Сервер использует Socket.io для обеспечения real-time обновлений:
- Уведомления о новых приглашениях
- Обновления статусов тренировок

## Структура проекта
```
serverSide/
├── src/
│   ├── routes/      # API маршруты
│   ├── handlers/    # Обработчики запросов
│   ├── db/          # Модели и взаимодействие с БД
│   ├── services/    # Бизнес-логика
│   ├── plugins/     # Fastify плагины
│   ├── sockets/     # Socket.io обработчики
│   └── utils/       # Вспомогательные функции
├── types/          # TypeScript типы
└── config.ts       # Конфигурация
```

## Тестирование

Проект настроен для тестирования с использованием Vitest:
```bash
npm run test
```

## Безопасность
- Пароли хешируются с использованием Bcrypt
- Используется cookie-based аутентификация
- Реализована CORS защита через @fastify/cors
- Валидация всех входящих данных

## Известные проблемы
- Необходимо улучшение обработки signature для аутентификации

## Контакты
По вопросам разработки и поддержки обращайтесь к команде разработки. 